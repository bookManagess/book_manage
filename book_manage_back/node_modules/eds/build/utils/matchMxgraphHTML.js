const chalk = require('chalk');

module.exports = function matchMxgraphHTML(sets, cb) {
  const regex = /\((.*?)\)/g;
  let match = regex.exec(sets.htmlString);
  while (match != null) {
    if (!match[1].includes('API_') && !match[1].includes('flowchart_')) {
      match = regex.exec(sets.htmlString);
      continue;
    }
    if (match[1].includes(';') || match[1].includes('&')) {
      // console.log(chalk.yellow(`Warning. Detected illegal char ${match[1]} at ${sets.file.path}. It may cause unpredictable behavior.`));
    }
    const mappingName = match[1].replace(/&lt;|&gt;|span|\//g, '');
    cb(match, mappingName);
    match = regex.exec(sets.htmlString);
  }
};